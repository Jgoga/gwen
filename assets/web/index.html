<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Gwen</title>
    <link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>
<div id="models">
    <h2>Models</h2>

    <form id="newModel">
        <div>
            <label for="modelName">Model:</label>
            <input type="text" id="modelName" placeholder="name">
        </div>

        <div>
            <label for="modelType">Type:</label>
            <select id="modelType">
                <option value="Question">Question Answering</option>
                <option value="Command">Command</option>
            </select>
        </div>
        <div>
            <label for="modelFile">File:</label>
            <input type="file" id="modelFile">
        </div>
        <div>
            <button type="button" id="modelSave">Save</button>
        </div>
    </form>

    <table id="modelList">

    </table>
</div>

</body>
<script type="text/javascript" src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
<script type="text/javascript" src="gwen.js"></script>
<script type="text/javascript" >
refreshModels();

$("#modelSave").click(function() {
    var formData = new FormData();
    formData.append("modelName", $("#modelName").val());
    formData.append("modelType", $("#modelType").val());
    formData.append("file", $("#modelFile")[0].files[0]);

    $.ajax({
        url: "modelSave",
        type: "POST",
        data: formData,
        processData: false,
        contentType: false,
        success: function(data) {
            $("#modelName").val("");
            $("#modelFile").val("");
            applyModels(data);
        },
        error: function(data) {
            alert("Couldn't save model");
        }
    })
})

function refreshModels() {
    $.ajax({
        url: "models",
        success: applyModels,
        error: function(data) {
        }
    });
}

function applyModels(data) {
    $("#modelList").empty();
    $("#modelList").append("<tr><th>Name</th><th>Type</th><th></th></tr>")

    for (var i = 0; i < data.length; i++) {
        var model = data[i];
        var modelHtml = $("<tr><td>" + model.name + "</td><td>" + model.type + "</td><td><button>Delete</button></td></tr>");

        (function() {
            var name = model.name;
            modelHtml.find("button").click(function(el) {
                $.ajax({
                    url: "modelDelete",
                    data: { name: name },
                    success: applyModels,
                    error: function(data) {
                        alert("Couldn't delete model " + name);
                    }
                });
            })
        })();
        $("#modelList").append(modelHtml);
    }
}

</script>
</html>